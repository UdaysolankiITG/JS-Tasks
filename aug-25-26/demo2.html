<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi-API E-Commerce</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .product, .cart-item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .product img { width: 100px; }
    .cart { margin-top: 30px; }
  </style>
</head>
<body>

  <h1>üõçÔ∏è My Multi-API Store</h1>

  <label for="userSelect">Select User:</label>
  <select id="userSelect">
    <option value="">-- Choose a User --</option>
  </select>

  <h2>üßæ Products</h2>
  <div id="products"></div>

  <h2>üõí Cart</h2>
  <div id="cart"></div>

  <script>
    const productsDiv = document.getElementById('products');
    const cartDiv = document.getElementById('cart');
    const userSelect = document.getElementById('userSelect');

    let cart = [];
    let currentUserId = null;

    // 1. Fetch Users from API (Second API)
    async function fetchUsers() {
      const res = await fetch('https://fakestoreapi.com/users');
      const users = await res.json();
      users.forEach(user => {
        const option = document.createElement('option');
        option.value = user.id;
        option.textContent = user.username;
        userSelect.appendChild(option);
      });
    }

    // 2. Track Selected User
    userSelect.addEventListener('change', () => {
      currentUserId = userSelect.value;
      cart = []; // reset cart on user change
      displayCart();
    });

    // 3. Fetch Products from API (First API)
    async function fetchProducts() {
      const res = await fetch('https://fakestoreapi.com/products');
      const products = await res.json();
      displayProducts(products);
    }

    // 4. Display Products
    function displayProducts(products) {
      productsDiv.innerHTML = '';
      products.forEach(product => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <h3>${product.title}</h3>
          <img src="${product.image}" />
          <p>$${product.price}</p>
          <button onclick="addToCart(${product.id})">Add to Cart</button>
        `;
        productsDiv.appendChild(div);
      });
    }

    // 5. Add to Cart
    async function addToCart(productId) {
      if (!currentUserId) {
        alert('Please select a user first!');
        return;
      }

      // Fake POST to Cart API
      const res = await fetch('https://fakestoreapi.com/carts', {
        method: 'POST',
        body: JSON.stringify({
          userId: parseInt(currentUserId),
          date: new Date(),
          products: [{ productId: productId, quantity: 1 }]
        }),
        headers: { 'Content-Type': 'application/json' }
      });

      const data = await res.json();
      console.log('Cart Updated (API):', data);

      // Add to local cart
      const productRes = await fetch(`https://fakestoreapi.com/products/${productId}`);
      const product = await productRes.json();
      cart.push(product);
      displayCart();
    }

    // 6. Display Cart
    function displayCart() {
      cartDiv.innerHTML = '';
      cart.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <strong>${item.title}</strong> - $${item.price}
          <button onclick="removeFromCart(${index})">Delete</button>
        `;
        cartDiv.appendChild(div);
      });
    }

    // 7. Remove from Cart
    function removeFromCart(index) {
      cart.splice(index, 1);
      displayCart();
    }

    // Init
    fetchUsers();    // Load users (second API)
    fetchProducts(); // Load products (first API)
  </script>

</body>`
</html>
